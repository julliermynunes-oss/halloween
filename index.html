<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vota√ß√£o de Fantasias de Halloween üéÉ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-bg: #0a0a0a;
            --secondary-bg: #1a1a1a;
            --card-bg: #1e1e1e;
            --accent-orange: #ff6b35;
            --accent-purple: #9d4edd;
            --accent-green: #06d6a0;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #666666;
            --border-color: #333333;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.4);
            --gradient: linear-gradient(135deg, var(--accent-orange), var(--accent-purple));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(157, 78, 221, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        h1 {
            font-family: 'Creepster', cursive;
            font-size: clamp(2.5rem, 5vw, 4rem);
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-weight: 300;
        }

        .admin-toggle {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .admin-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .costumes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .costume-card {
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
            position: relative;
            backdrop-filter: blur(10px);
        }

        .costume-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-hover);
            border-color: var(--accent-orange);
        }

        .costume-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            transition: transform 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .costume-card:hover .costume-image {
            transform: scale(1.05);
        }

        .costume-image::after {
            content: 'üîç';
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 8px;
            border-radius: 50%;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .costume-card:hover .costume-image::after {
            opacity: 1;
        }

        .costume-info {
            padding: 1.5rem;
        }

        .costume-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .vote-count {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .vote-count span {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.3rem;
        }

        .btn-vote {
            width: 100%;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-vote::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-vote:hover::before {
            left: 100%;
        }

        .btn-vote:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
        }

        .btn-vote:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-vote:disabled::before {
            display: none;
        }

        /* Admin Panel */
        #admin-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 3rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            display: none;
            backdrop-filter: blur(10px);
        }

        #admin-access {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 3rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        #admin-access h3 {
            color: var(--accent-orange);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        #admin-access p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        #admin-access code {
            background: var(--secondary-bg);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            color: var(--accent-green);
            font-family: monospace;
        }

        #admin-panel h2 {
            font-family: 'Creepster', cursive;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 2rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input[type="text"],
        .form-group input[type="file"] {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--secondary-bg);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="file"]:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-group input[type="file"] {
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .admin-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .admin-buttons button {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .admin-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.3);
        }

        .admin-buttons button:last-child {
            background: linear-gradient(135deg, #ff4757, #ff6b35);
        }

        .admin-buttons button:last-child:hover {
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .costumes-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .admin-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .admin-buttons button {
                width: 100%;
                max-width: 300px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-orange);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .message {
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            font-weight: 500;
            text-align: center;
        }

        .message.success {
            background: rgba(6, 214, 160, 0.1);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }

        .message.error {
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        /* Modal para visualiza√ß√£o de imagem */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
        }

        .image-modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease;
        }

        .modal-image {
            max-width: 100%;
            max-height: 80%;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            cursor: zoom-in;
            transition: transform 0.3s ease;
        }

        .modal-image.zoomed {
            transform: scale(1.5);
            cursor: zoom-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
            color: white;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .modal-close {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .modal-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            color: white;
            backdrop-filter: blur(10px);
        }

        .modal-votes {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .modal-votes span {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .modal-instructions {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 10px;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Responsive para mobile */
        @media (max-width: 768px) {
            .image-modal-content {
                width: 95%;
                height: 95%;
                padding: 10px;
            }
            
            .modal-title {
                font-size: 1.2rem;
            }
            
            .modal-close {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
        }

        /* Tela de Resultados */
        #results-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            z-index: 2000;
            overflow-y: auto;
            animation: resultsFadeIn 0.8s ease-out;
        }

        .results-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: slideDown 1s ease-out 0.5s both;
        }

        .results-title {
            font-family: 'Creepster', cursive;
            font-size: clamp(3rem, 8vw, 5rem);
            background: linear-gradient(45deg, #ff6b35, #9d4edd, #06d6a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(255, 107, 53, 0.5);
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.05);
                filter: brightness(1.2);
            }
        }

        .results-subtitle {
            font-size: 1.5rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .podium-container {
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            min-height: 500px;
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transform: translateY(100px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .podium-place.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        .podium-place.first {
            order: 2;
            animation: firstPlaceReveal 2s ease-out 8s both;
        }

        .podium-place.second {
            order: 1;
            animation: secondPlaceReveal 1.5s ease-out 5s both;
        }

        .podium-place.third {
            order: 3;
            animation: thirdPlaceReveal 1.2s ease-out 2s both;
        }

        .podium-stand {
            width: 200px;
            height: 200px;
            border-radius: 20px 20px 0 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .podium-stand:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        }

        .podium-stand.revealing {
            animation: spotlightReveal 2s ease-out;
        }

        @keyframes spotlightReveal {
            0% {
                box-shadow: 0 0 0 rgba(255, 255, 255, 0);
            }
            50% {
                box-shadow: 0 0 50px rgba(255, 255, 255, 0.8), 0 0 100px rgba(255, 255, 255, 0.4);
            }
            100% {
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            }
        }

        .podium-stand.first {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            height: 250px;
            box-shadow: 0 25px 50px rgba(255, 215, 0, 0.3);
        }

        .podium-stand.second {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            height: 200px;
            box-shadow: 0 20px 40px rgba(192, 192, 192, 0.3);
        }

        .podium-stand.third {
            background: linear-gradient(135deg, #cd7f32, #daa520);
            height: 150px;
            box-shadow: 0 15px 30px rgba(205, 127, 50, 0.3);
        }

        .podium-number {
            font-size: 3rem;
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 1rem;
        }

        .podium-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            margin-bottom: 1rem;
        }

        .podium-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 0.5rem;
        }

        .podium-votes {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .podium-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin-top: 0.5rem;
            max-width: 180px;
            line-height: 1.3;
        }

        .results-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            animation: slideUp 1s ease-out 10s both;
        }

        .btn-results {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            min-width: 150px;
        }

        .btn-results:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .btn-results.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .btn-results.secondary:hover {
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--accent-orange);
            animation: confettiFall 3s linear infinite;
        }

        .confetti:nth-child(2n) {
            background: var(--accent-purple);
            animation-delay: 0.5s;
        }

        .confetti:nth-child(3n) {
            background: var(--accent-green);
            animation-delay: 1s;
        }

        @keyframes resultsFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes thirdPlaceReveal {
            0% {
                opacity: 0;
                transform: translateY(150px) scale(0.5) rotateX(90deg);
            }
            50% {
                opacity: 0.8;
                transform: translateY(50px) scale(0.9) rotateX(45deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotateX(0deg);
            }
        }

        @keyframes secondPlaceReveal {
            0% {
                opacity: 0;
                transform: translateY(150px) scale(0.5) rotateX(90deg);
            }
            50% {
                opacity: 0.8;
                transform: translateY(50px) scale(0.9) rotateX(45deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotateX(0deg);
            }
        }

        @keyframes firstPlaceReveal {
            0% {
                opacity: 0;
                transform: translateY(200px) scale(0.3) rotateX(90deg);
            }
            30% {
                opacity: 0.6;
                transform: translateY(100px) scale(0.7) rotateX(60deg);
            }
            60% {
                opacity: 0.9;
                transform: translateY(20px) scale(1.1) rotateX(20deg);
            }
            80% {
                opacity: 1;
                transform: translateY(-10px) scale(1.05) rotateX(0deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotateX(0deg);
            }
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Responsive para mobile */
        @media (max-width: 768px) {
            .podium-container {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .podium-place {
                order: unset !important;
            }

            .podium-place.first {
                order: 1 !important;
            }

            .podium-place.second {
                order: 2 !important;
            }

            .podium-place.third {
                order: 3 !important;
            }

            .podium-stand {
                width: 150px;
                height: 150px;
            }

            .podium-stand.first {
                height: 180px;
            }

            .podium-stand.second {
                height: 150px;
            }

            .podium-stand.third {
                height: 120px;
            }

            .podium-image {
                width: 80px;
                height: 80px;
            }

            .results-actions {
                flex-direction: column;
                align-items: center;
            }

            .btn-results {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
        <h1>Vota√ß√£o de Fantasias</h1>
        <p class="subtitle">Clique para votar na sua fantasia favorita!</p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1rem;">
            <button id="admin-access-btn" class="admin-toggle">Acesso Admin</button>
                <button id="show-results-btn-main" class="admin-toggle" style="background: linear-gradient(135deg, #9d4edd, #06d6a0);">Ver Resultados</button>
                <button id="identify-voter-btn" class="admin-toggle" style="background: linear-gradient(135deg, #ff6b35, #ffa502);">Identificar-se para Votar</button>
            </div>
            <div id="voter-status" style="margin-top: 1rem; text-align: center; color: var(--text-secondary); font-size: 1rem;">
                <!-- Status do votante ser√° exibido aqui -->
            </div>
        </div>

        <div id="costumes-container" class="costumes-grid">
            </div>

        <!-- Acesso Administrativo -->
        <div id="admin-access">
            <h3>üîê Acesso Administrativo</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                Digite a senha para acessar o painel administrativo
            </p>
            <div class="form-group">
                <label for="admin-password">Senha do Admin:</label>
                <input type="password" id="admin-password" placeholder="Digite a senha para acessar o painel" 
                       style="width: 100%; padding: 0.875rem 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--secondary-bg); color: var(--text-primary); font-size: 1rem; text-align: center;">
            </div>
            <button type="button" id="admin-login-btn" class="btn-results" style="margin-top: 1rem;">üîì Acessar Painel Admin</button>
        </div>

        <div id="admin-panel">
            <h2>Painel de Administra√ß√£o</h2>
            <div id="storage-info" style="background: var(--secondary-bg); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                <p style="margin: 0; color: var(--text-secondary);">Armazenamento: <span id="storage-usage">Calculando...</span></p>
            </div>
            <form id="add-costume-form">
                <div class="form-group">
                <label for="costume-name">Nome da Fantasia:</label>
                    <input type="text" id="costume-name" required placeholder="Digite o nome da fantasia">
                </div>
                
                <div class="form-group">
                    <label for="costume-description">Descri√ß√£o da Fantasia (opcional):</label>
                    <textarea id="costume-description" placeholder="Digite uma descri√ß√£o da fantasia..." style="width: 100%; padding: 0.875rem 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--secondary-bg); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease; resize: vertical; min-height: 80px; font-family: inherit;"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Escolha o m√©todo de adicionar imagem:</label>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="image-method" value="url" checked>
                            <span>URL Externa</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="radio" name="image-method" value="upload">
                            <span>Upload de Arquivo</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group" id="url-input-group">
                    <label for="costume-image-url">URL da Imagem:</label>
                    <input type="url" id="costume-image-url" placeholder="https://drive.google.com/file/d/... ou https://imgur.com/...">
                    <small style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.5rem; display: block;">
                        <strong>Google Drive:</strong> Use o link de compartilhamento do arquivo<br>
                        <strong>Outros:</strong> Dropbox, Imgur, Flickr, Unsplash, Pixabay, Pexels
                    </small>
                </div>
                
                <div class="form-group" id="file-input-group" style="display: none;">
                <label for="costume-image-upload">Upload da Imagem:</label>
                    <input type="file" id="costume-image-upload" accept="image/*">
                </div>
                
                <div class="admin-buttons">
                    <button type="submit">Adicionar Fantasia</button>
                    <button type="button" id="show-results-btn">Mostrar Resultados Finais</button>
                    <button type="button" id="clear-storage-btn">Limpar Armazenamento</button>
                    <button type="button" id="reset-votes-btn">Resetar Tudo</button>
                    <button type="button" id="logout-admin-btn" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">üö™ Sair do Admin</button>
                </div>
                
                <div style="margin-top: 2rem; padding: 1.5rem; background: var(--secondary-bg); border-radius: 12px; border: 1px solid var(--border-color);">
                    <h3 style="color: var(--text-primary); margin-bottom: 1rem; text-align: center;">üì§ Compartilhar Dados</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; text-align: center;">
                        Para que todos vejam as mesmas fantasias e votos, use estas fun√ß√µes:
                    </p>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1rem;">
                        <button type="button" id="export-data-btn" class="btn-results" style="background: linear-gradient(135deg, #06d6a0, #118ab2);">üì• Exportar Dados</button>
                        <button type="button" id="import-data-btn" class="btn-results" style="background: linear-gradient(135deg, #9d4edd, #c77dff);">üì§ Importar Dados</button>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="shared-url" style="color: var(--text-primary); font-size: 0.9rem;">URL Compartilhada (opcional):</label>
                        <input type="url" id="shared-url" placeholder="https://exemplo.com/dados.json" 
                               style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-bg); color: var(--text-primary); font-size: 0.9rem;">
                        <small style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.25rem; display: block;">
                            Se voc√™ tiver uma URL com dados compartilhados, cole aqui para sincronizar
                        </small>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button type="button" id="load-shared-data-btn" class="btn-results secondary">üîÑ Carregar Dados Compartilhados</button>
                        <button type="button" id="save-shared-data-btn" class="btn-results secondary">üíæ Salvar Dados Atuais</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para visualiza√ß√£o de imagem -->
    <div id="image-modal" class="image-modal">
        <div class="image-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Nome da Fantasia</h3>
                <button class="modal-close" id="modal-close">Fechar</button>
            </div>
            <img id="modal-image" class="modal-image" src="" alt="">
            <div class="modal-info">
                <div id="modal-description" style="margin-bottom: 15px; font-size: 1rem; line-height: 1.5; color: rgba(255, 255, 255, 0.9);"></div>
                <div class="modal-votes">
                    Votos: <span id="modal-votes">0</span>
                </div>
                <div class="modal-instructions">
                    Clique na imagem para ampliar ‚Ä¢ Clique fora para fechar
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para nome do votante -->
    <div id="voter-modal" class="image-modal" style="z-index: 1500;">
        <div class="image-modal-content" style="max-width: 500px; height: auto;">
            <div class="modal-header">
                <h3 class="modal-title">Identifica√ß√£o do Votante</h3>
            </div>
            <div style="padding: 2rem; text-align: center;">
                <p style="color: var(--text-secondary); margin-bottom: 2rem; font-size: 1.1rem;">
                    Para votar, precisamos saber seu nome. Voc√™ pode votar em at√© 3 fantasias diferentes, mas n√£o pode votar na sua pr√≥pria fantasia.
                </p>
                <div class="form-group" style="margin-bottom: 2rem;">
                    <label for="voter-name" style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                        Seu nome:
                    </label>
                    <input type="text" id="voter-name" placeholder="Digite seu nome completo" 
                           style="width: 100%; padding: 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--secondary-bg); color: var(--text-primary); font-size: 1.1rem; text-align: center;">
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn-results" id="confirm-voter-btn" style="min-width: 120px;">Confirmar</button>
                    <button class="btn-results secondary" id="cancel-voter-btn" style="min-width: 120px;">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Resultados -->
    <div id="results-screen">
        <div class="celebration" id="celebration"></div>
        <div class="results-container">
            <div class="results-header">
                <h1 class="results-title">üèÜ RESULTADOS FINAIS üèÜ</h1>
                <p class="results-subtitle">Os vencedores da vota√ß√£o de fantasias de Halloween!</p>
            </div>
            
            <div class="podium-container" id="podium-container">
                <!-- Os p√≥dios ser√£o inseridos aqui via JavaScript -->
            </div>
            
            <div class="results-actions">
                <button class="btn-results" id="back-to-voting-btn">Voltar √† Vota√ß√£o</button>
                <button class="btn-results secondary" id="share-results-btn">Compartilhar Resultados</button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'halloweenVoteData';
        const costumesContainer = document.getElementById('costumes-container');
        const adminPanel = document.getElementById('admin-panel');
        const adminAccessBtn = document.getElementById('admin-access-btn');
        const addCostumeForm = document.getElementById('add-costume-form');
        const showResultsBtn = document.getElementById('show-results-btn');
        const resetVotesBtn = document.getElementById('reset-votes-btn');
        const clearStorageBtn = document.getElementById('clear-storage-btn');
        const costumeImageUpload = document.getElementById('costume-image-upload');
        const costumeImageUrl = document.getElementById('costume-image-url');
        const urlInputGroup = document.getElementById('url-input-group');
        const fileInputGroup = document.getElementById('file-input-group');
        
        // Modal elements
        const imageModal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        const modalTitle = document.getElementById('modal-title');
        const modalVotes = document.getElementById('modal-votes');
        const modalClose = document.getElementById('modal-close');
        
        // Results screen elements
        const resultsScreen = document.getElementById('results-screen');
        const showResultsBtnMain = document.getElementById('show-results-btn-main');
        const backToVotingBtn = document.getElementById('back-to-voting-btn');
        const shareResultsBtn = document.getElementById('share-results-btn');
        const podiumContainer = document.getElementById('podium-container');
        const celebration = document.getElementById('celebration');
        
        // Voter modal elements
        const voterModal = document.getElementById('voter-modal');
        const voterNameInput = document.getElementById('voter-name');
        const confirmVoterBtn = document.getElementById('confirm-voter-btn');
        const cancelVoterBtn = document.getElementById('cancel-voter-btn');
        const identifyVoterBtn = document.getElementById('identify-voter-btn');
        const voterStatus = document.getElementById('voter-status');
        
        // Shared data elements
        const exportDataBtn = document.getElementById('export-data-btn');
        const importDataBtn = document.getElementById('import-data-btn');
        const sharedUrlInput = document.getElementById('shared-url');
        const loadSharedDataBtn = document.getElementById('load-shared-data-btn');
        const saveSharedDataBtn = document.getElementById('save-shared-data-btn');
        
        let costumes = [];
        let isAdminMode = false;
        let currentVoter = null;
        let voterVotes = {}; // Armazenar votos por votante
        const ADMIN_PASSWORD = 'festa'; // Senha do admin

        function loadData() {
            const storedData = localStorage.getItem(STORAGE_KEY);
            if (storedData) {
                try {
                    const data = JSON.parse(storedData);
                    costumes = data.costumes || [];
                    voterVotes = data.voterVotes || {};
                    isAdminMode = data.isAdminMode || false;
                    // Limpar dados antigos se necess√°rio
                    cleanupOldData();
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    costumes = [];
                    voterVotes = {};
                    isAdminMode = false;
                }
            }
            updateAdminPanelVisibility();
        }

        function cleanupOldData() {
            // Remover fantasias sem descri√ß√£o e com URLs muito longas (possivelmente data URLs antigas)
            const originalLength = costumes.length;
            costumes = costumes.filter(costume => {
                // Manter fantasias com URLs externas ou descri√ß√µes
                const hasExternalUrl = !costume.imageUrl.startsWith('data:');
                const hasDescription = costume.description && costume.description.trim().length > 0;
                const isReasonableSize = costume.imageUrl.length < 100000; // URLs n√£o devem ser muito longas
                
                return hasExternalUrl || hasDescription || isReasonableSize;
            });
            
            if (costumes.length !== originalLength) {
                console.log(`Limpeza autom√°tica: ${originalLength - costumes.length} fantasias removidas`);
                saveData();
            }
        }

        function updateStorageInfo() {
            try {
                const dataToSave = JSON.stringify(costumes);
                const dataSize = new Blob([dataToSave]).size;
                const maxSize = 5 * 1024 * 1024; // 5MB limit para metadados (aumentado)
                const usagePercent = (dataSize / maxSize) * 100;
                
                const storageUsage = document.getElementById('storage-usage');
                if (storageUsage) {
                    const sizeText = (dataSize / 1024).toFixed(2) + 'KB';
                    const percentText = usagePercent.toFixed(1) + '%';
                    
                    storageUsage.innerHTML = `${sizeText} (${percentText}) - Metadados apenas`;
                    
                    if (usagePercent > 80) {
                        storageUsage.style.color = '#ff4757';
                    } else if (usagePercent > 60) {
                        storageUsage.style.color = '#ffa502';
                    } else {
                        storageUsage.style.color = '#06d6a0';
                    }
                }
            } catch (error) {
                console.error('Erro ao calcular uso do armazenamento:', error);
            }
        }

        function saveData() {
            try {
                const dataToSave = JSON.stringify({
                    costumes: costumes,
                    voterVotes: voterVotes,
                    isAdminMode: isAdminMode
                });
                const dataSize = new Blob([dataToSave]).size;
                const maxSize = 5 * 1024 * 1024; // 5MB limit para metadados (aumentado)
                
                if (dataSize > maxSize) {
                    showMessage('Muitos metadados! Remova algumas fantasias antes de adicionar novas.', 'error');
                    return false;
                }
                
                localStorage.setItem(STORAGE_KEY, dataToSave);
                updateStorageInfo();
                return true;
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                if (error.name === 'QuotaExceededError') {
                    showMessage('Armazenamento cheio! Remova algumas fantasias antes de adicionar novas.', 'error');
                } else {
                    showMessage('Erro ao salvar dados. Verifique o armazenamento local.', 'error');
                }
                return false;
            }
        }

        function showMessage(message, type = 'success') {
            // Remove existing messages
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            
            // Insert after the header
            const header = document.querySelector('.header');
            header.insertAdjacentElement('afterend', messageDiv);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }

        function checkAdminPassword() {
            const password = document.getElementById('admin-password').value.trim();
            
            if (password === ADMIN_PASSWORD) {
                isAdminMode = true;
                document.getElementById('admin-password').value = '';
                saveData();
                updateAdminPanelVisibility();
                showMessage('Acesso administrativo concedido!', 'success');
            } else {
                showMessage('Senha incorreta! Tente novamente.', 'error');
                document.getElementById('admin-password').value = '';
            }
        }

        function updateAdminPanelVisibility() {
            const adminPanel = document.getElementById('admin-panel');
            const adminAccess = document.getElementById('admin-access');
            
            if (isAdminMode) {
                adminPanel.style.display = 'block';
                adminAccess.style.display = 'none';
            } else {
                adminPanel.style.display = 'none';
                adminAccess.style.display = 'block';
            }
        }

        function logoutAdmin() {
            isAdminMode = false;
            saveData();
            updateAdminPanelVisibility();
            showMessage('Logout realizado! Painel administrativo oculto.', 'info');
        }

        function updateVoterStatus() {
            if (currentVoter) {
                const votesUsed = voterVotes[currentVoter] ? voterVotes[currentVoter].length : 0;
                const votesRemaining = 3 - votesUsed;
                voterStatus.innerHTML = `
                    <div style="background: rgba(6, 214, 160, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid var(--accent-green);">
                        <strong style="color: var(--accent-green);">‚úÖ Identificado como: ${currentVoter}</strong><br>
                        <span style="color: var(--text-secondary);">Votos usados: ${votesUsed}/3 | Restantes: ${votesRemaining}</span>
                    </div>
                `;
                identifyVoterBtn.textContent = 'Alterar Identifica√ß√£o';
                identifyVoterBtn.style.background = 'linear-gradient(135deg, #6c757d, #495057)';
            } else {
                voterStatus.innerHTML = `
                    <div style="background: rgba(255, 107, 53, 0.1); padding: 1rem; border-radius: 12px; border: 1px solid var(--accent-orange);">
                        <span style="color: var(--accent-orange);">‚ö†Ô∏è Identifique-se para votar</span>
                    </div>
                `;
                identifyVoterBtn.textContent = 'Identificar-se para Votar';
                identifyVoterBtn.style.background = 'linear-gradient(135deg, #ff6b35, #ffa502)';
            }
        }

        function renderCostumes(sort = false) {
            try {
            costumesContainer.innerHTML = '';
            
            // Atualizar status do votante
            updateVoterStatus();
                
                if (costumes.length === 0) {
                    costumesContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <h3>Nenhuma fantasia cadastrada ainda</h3>
                            <p>Use o painel de administra√ß√£o para adicionar fantasias</p>
                        </div>
                    `;
                    return;
                }
            
            const listToRender = sort ? [...costumes].sort((a, b) => b.votes - a.votes) : costumes;

            listToRender.forEach((costume) => {
                    try {
                const costumeCard = document.createElement('div');
                costumeCard.className = 'costume-card';
                costumeCard.dataset.id = costume.id;
                        
                        // Sanitize the name to prevent XSS
                        const safeName = costume.name.replace(/[<>]/g, '');
                
                // Verificar se o votante atual j√° votou nesta fantasia
                const hasVoted = currentVoter && voterVotes[currentVoter] && voterVotes[currentVoter].includes(costume.id);
                
                // Verificar se √© a pr√≥pria fantasia do votante
                const isOwnCostume = currentVoter && costume.name.toLowerCase().trim() === currentVoter.toLowerCase().trim();
                
                // Calcular votos restantes
                const votesUsed = currentVoter && voterVotes[currentVoter] ? voterVotes[currentVoter].length : 0;
                const votesRemaining = 3 - votesUsed;
                
                // Determinar estado do bot√£o
                let buttonState = '';
                let buttonText = 'Votar';
                let cardStyle = '';
                
                if (!currentVoter) {
                    buttonState = 'disabled';
                    buttonText = 'Identifique-se para votar';
                } else if (isOwnCostume) {
                    buttonState = 'disabled';
                    buttonText = 'Sua pr√≥pria fantasia';
                    cardStyle = 'border: 2px solid var(--accent-orange); background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 107, 53, 0.05));';
                } else if (hasVoted) {
                    buttonState = 'disabled';
                    buttonText = 'J√° votou';
                } else if (votesRemaining <= 0) {
                    buttonState = 'disabled';
                    buttonText = 'Limite de votos atingido';
                }
                
                costumeCard.innerHTML = `
                            <img src="${costume.imageUrl}" alt="${safeName}" class="costume-image" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjI4MCIgdmlld0JveD0iMCAwIDMwMCAyODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjgwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTQwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2NjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkVycm8gYW8gY2FycmVnYXIgaW1hZ2VtPC90ZXh0Pgo8L3N2Zz4K'" title="Clique para ampliar">
                    <div class="costume-info">
                                <h3 class="costume-name">${safeName}${isOwnCostume ? ' <span style="color: var(--accent-orange); font-size: 0.8em;">(Sua fantasia)</span>' : ''}</h3>
                        ${costume.description ? `<p class="costume-description" style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.4;">${costume.description}</p>` : ''}
                        <p class="vote-count">Votos: <span id="votes-${costume.id}">${costume.votes}</span></p>
                        ${currentVoter ? `<p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Votos restantes: ${votesRemaining}</p>` : ''}
                        <button class="btn-vote" data-id="${costume.id}" ${buttonState}>${buttonText}</button>
                        ${isAdminMode ? `<button class="btn-delete" data-id="${costume.id}" style="background: linear-gradient(135deg, #ff4757, #ff6b35); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 0.5rem; width: 100%;">üóëÔ∏è Excluir</button>` : ''}
                    </div>
                `;
                
                // Aplicar estilo especial para a pr√≥pria fantasia
                if (isOwnCostume) {
                    costumeCard.style.cssText = cardStyle;
                }
                costumesContainer.appendChild(costumeCard);
                        
                        // Adicionar evento de clique na imagem
                        const costumeImage = costumeCard.querySelector('.costume-image');
                        costumeImage.addEventListener('click', () => {
                            openImageModal(costume);
                        });
                    } catch (error) {
                        console.error('Erro ao renderizar fantasia:', costume, error);
                    }
            });
            
            document.querySelectorAll('.btn-vote').forEach(button => {
                button.addEventListener('click', handleVote);
            });
            
            // Adicionar eventos para bot√µes de exclus√£o (apenas em modo admin)
            if (isAdminMode) {
                document.querySelectorAll('.btn-delete').forEach(button => {
                    button.addEventListener('click', handleDelete);
                });
            }
            } catch (error) {
                console.error('Erro ao renderizar fantasias:', error);
                showMessage('Erro ao exibir fantasias. Recarregue a p√°gina.', 'error');
            }
        }

        function handleVote(event) {
            const costumeId = event.target.dataset.id;
            const costume = costumes.find(c => c.id === costumeId);
            
            if (!currentVoter) {
                // Mostrar modal para identifica√ß√£o
                showVoterModal(costumeId);
                return;
            }
            
            if (!costume) return;
            
            // Verificar se j√° votou nesta fantasia
            const hasVoted = voterVotes[currentVoter] && voterVotes[currentVoter].includes(costumeId);
            if (hasVoted) return;
            
            // Verificar se √© a pr√≥pria fantasia
            const isOwnCostume = costume.name.toLowerCase().trim() === currentVoter.toLowerCase().trim();
            if (isOwnCostume) {
                showMessage('Voc√™ n√£o pode votar na sua pr√≥pria fantasia!', 'error');
                return;
            }
            
            // Verificar limite de votos
            const votesUsed = voterVotes[currentVoter] ? voterVotes[currentVoter].length : 0;
            if (votesUsed >= 3) {
                showMessage('Voc√™ j√° atingiu o limite de 3 votos!', 'error');
                return;
            }
            
            // Registrar voto
            if (!voterVotes[currentVoter]) {
                voterVotes[currentVoter] = [];
            }
            voterVotes[currentVoter].push(costumeId);
                costume.votes++;
            
                saveData();
            renderCostumes();
                
                // Atualizar votos no modal se estiver aberto
                if (imageModal.style.display === 'block' && modalTitle.textContent === costume.name) {
                    modalVotes.textContent = costume.votes;
                }
                
            const votesRemaining = 3 - voterVotes[currentVoter].length;
            showMessage(`Voto registrado! Voc√™ tem ${votesRemaining} voto(s) restante(s).`);
        }

        function showVoterModal(costumeId = null) {
            voterModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            voterNameInput.focus();
            voterNameInput.value = '';
            
            // Armazenar ID da fantasia para votar ap√≥s identifica√ß√£o
            if (costumeId) {
                voterNameInput.dataset.costumeId = costumeId;
            }
        }

        function hideVoterModal() {
            voterModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            voterNameInput.dataset.costumeId = '';
        }

        function clearVoterIdentity() {
            currentVoter = null;
            updateVoterStatus();
            renderCostumes();
            showMessage('Identifica√ß√£o removida. Voc√™ precisa se identificar novamente para votar.');
        }

        function confirmVoter() {
            const voterName = voterNameInput.value.trim();
            
            if (!voterName) {
                showMessage('Por favor, digite seu nome.', 'error');
                return;
            }
            
            currentVoter = voterName;
            hideVoterModal();
            
            // Atualizar status do votante
            updateVoterStatus();
            renderCostumes();
            
            // Verificar se existe uma fantasia com o mesmo nome
            const ownCostume = costumes.find(c => 
                c.name.toLowerCase().trim() === voterName.toLowerCase().trim()
            );
            
            if (ownCostume) {
                showMessage(`Bem-vindo(a), ${voterName}! Voc√™ pode votar em at√© 3 fantasias diferentes, mas n√£o pode votar na sua pr√≥pria fantasia "${ownCostume.name}".`);
            } else {
                showMessage(`Bem-vindo(a), ${voterName}! Voc√™ pode votar em at√© 3 fantasias diferentes.`);
            }
            
            // Se havia uma fantasia selecionada, tentar votar nela
            const costumeId = voterNameInput.dataset.costumeId;
            if (costumeId) {
                const costume = costumes.find(c => c.id === costumeId);
                if (costume) {
                    // Verificar se n√£o √© a pr√≥pria fantasia
                    if (costume.name.toLowerCase().trim() === voterName.toLowerCase().trim()) {
                        showMessage('Voc√™ n√£o pode votar na sua pr√≥pria fantasia!', 'error');
                    } else {
                        // Simular clique no bot√£o de votar
                        setTimeout(() => {
                            const voteButton = document.querySelector(`[data-id="${costumeId}"]`);
                            if (voteButton && !voteButton.disabled) {
                                handleVote({ target: voteButton });
                            }
                        }, 100);
                    }
                }
            }
        }

        function handleDelete(event) {
            const costumeId = event.target.dataset.id;
            const costume = costumes.find(c => c.id === costumeId);
            
            if (costume && confirm(`Tem certeza que deseja excluir a fantasia "${costume.name}"?`)) {
                const index = costumes.findIndex(c => c.id === costumeId);
                if (index > -1) {
                    costumes.splice(index, 1);
                    
                    // Remover votos desta fantasia de todos os votantes
                    Object.keys(voterVotes).forEach(voter => {
                        voterVotes[voter] = voterVotes[voter].filter(id => id !== costumeId);
                    });
                    
                    saveData();
                    renderCostumes();
                    showMessage('Fantasia exclu√≠da com sucesso!');
                }
            }
        }

        function addCostume(name, imageUrl, description = '') {
            try {
            const newId = (Date.now() + Math.random()).toString();
                
                const newCostume = {
                id: newId,
                name: name,
                    imageUrl: imageUrl,
                description: description,
                votes: 0
                };
                
                costumes.push(newCostume);
                
                // Salvar metadados no localStorage
                if (saveData()) {
                    renderCostumes();
                    showMessage('Fantasia adicionada com sucesso!');
                } else {
                    // Remover a fantasia se n√£o conseguiu salvar
                    costumes.pop();
                    throw new Error('N√£o foi poss√≠vel salvar devido ao limite de armazenamento');
                }
            } catch (error) {
                console.error('Erro ao adicionar fantasia:', error);
                showMessage('Erro ao adicionar fantasia. Tente novamente.', 'error');
                throw error; // Re-throw para ser capturado pelo try-catch do upload
            }
        }

        function validateImage(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB (ser√° comprimido depois)
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            
            if (!allowedTypes.includes(file.type)) {
                showMessage('Tipo de arquivo n√£o suportado. Use JPG, PNG, GIF ou WebP.', 'error');
                return false;
            }
            
            if (file.size > maxSize) {
                showMessage('Arquivo muito grande. Tamanho m√°ximo: 10MB (ser√° comprimido automaticamente).', 'error');
                return false;
            }
            
            return true;
        }

        // Sistema de URLs externas para imagens
        function validateImageUrl(url) {
            try {
                const urlObj = new URL(url);
                const allowedDomains = [
                    'drive.google.com',
                    'docs.google.com',
                    'dropbox.com',
                    'onedrive.live.com',
                    'imgur.com',
                    'flickr.com',
                    'unsplash.com',
                    'pixabay.com',
                    'pexels.com'
                ];
                
                const domain = urlObj.hostname.toLowerCase();
                const isAllowed = allowedDomains.some(allowedDomain => 
                    domain.includes(allowedDomain)
                );
                
                if (!isAllowed) {
                    showMessage('Dom√≠nio n√£o permitido. Use Google Drive, Dropbox, Imgur ou outros servi√ßos confi√°veis.', 'error');
                    return false;
                }
                
                // Valida√ß√£o espec√≠fica para Google Drive
                if (domain.includes('drive.google.com')) {
                    const googleDrivePattern = /\/file\/d\/([a-zA-Z0-9-_]+)/;
                    if (!googleDrivePattern.test(url)) {
                        showMessage('URL do Google Drive inv√°lida. Use o link de compartilhamento do arquivo.', 'error');
                        return false;
                    }
                }
                
                return true;
            } catch (error) {
                showMessage('URL inv√°lida. Verifique se a URL est√° correta.', 'error');
                return false;
            }
        }

        function convertGoogleDriveUrl(url) {
            // Converter URL do Google Drive para formato direto
            if (url.includes('drive.google.com/file/d/')) {
                const fileId = url.match(/\/file\/d\/([a-zA-Z0-9-_]+)/);
                if (fileId) {
                    return `https://drive.google.com/uc?export=view&id=${fileId[1]}`;
                }
            }
            return url;
        }

        function validateAndConvertGoogleDriveUrl(url) {
            // Verificar se √© uma URL do Google Drive v√°lida
            const googleDrivePattern = /https:\/\/drive\.google\.com\/file\/d\/([a-zA-Z0-9-_]+)/;
            const match = url.match(googleDrivePattern);
            
            if (match) {
                const fileId = match[1];
                return `https://drive.google.com/uc?export=view&id=${fileId}`;
            }
            
            return url;
        }

        function convertDropboxUrl(url) {
            // Converter URL do Dropbox para formato direto
            if (url.includes('dropbox.com/s/')) {
                return url.replace('?dl=0', '?raw=1');
            }
            return url;
        }

        function optimizeImageUrl(url) {
            let optimizedUrl = url;
            
            // Otimizar URLs do Google Drive
            optimizedUrl = validateAndConvertGoogleDriveUrl(optimizedUrl);
            
            // Otimizar URLs do Dropbox
            optimizedUrl = convertDropboxUrl(optimizedUrl);
            
            return optimizedUrl;
        }

        // Fun√ß√µes do modal
        function openImageModal(costume) {
            modalTitle.textContent = costume.name;
            modalImage.src = costume.imageUrl;
            modalImage.alt = costume.name;
            modalVotes.textContent = costume.votes;
            
            // Mostrar descri√ß√£o se existir
            const modalDescription = document.getElementById('modal-description');
            if (costume.description && costume.description.trim()) {
                modalDescription.textContent = costume.description;
                modalDescription.style.display = 'block';
            } else {
                modalDescription.style.display = 'none';
            }
            
            imageModal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevenir scroll
        }

        function closeImageModal() {
            imageModal.style.display = 'none';
            modalImage.classList.remove('zoomed');
            document.body.style.overflow = 'auto'; // Restaurar scroll
        }

        function toggleImageZoom() {
            modalImage.classList.toggle('zoomed');
        }

        // Sistema de sons
        let audioContext = null;
        
        function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Web Audio API n√£o suportada');
                }
            }
        }

        function playDrumSound(frequency = 100, duration = 0.3, type = 'sine') {
            if (!audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log('Erro ao reproduzir som:', e);
            }
        }

        function playDrumRoll() {
            if (!audioContext) return;
            
            // Sequ√™ncia de tambores para criar tens√£o
            const drumSequence = [
                { freq: 80, duration: 0.2, delay: 0 },
                { freq: 90, duration: 0.2, delay: 0.3 },
                { freq: 100, duration: 0.2, delay: 0.6 },
                { freq: 120, duration: 0.3, delay: 0.9 },
                { freq: 150, duration: 0.4, delay: 1.2 }
            ];
            
            drumSequence.forEach(drum => {
                setTimeout(() => {
                    playDrumSound(drum.freq, drum.duration, 'sawtooth');
                }, drum.delay * 1000);
            });
        }

        function playVictorySound() {
            if (!audioContext) return;
            
            // Som de vit√≥ria - acordes ascendentes
            const victorySequence = [
                { freq: 200, duration: 0.3, delay: 0 },
                { freq: 250, duration: 0.3, delay: 0.2 },
                { freq: 300, duration: 0.3, delay: 0.4 },
                { freq: 400, duration: 0.5, delay: 0.6 }
            ];
            
            victorySequence.forEach(note => {
                setTimeout(() => {
                    playDrumSound(note.freq, note.duration, 'sine');
                }, note.delay * 1000);
            });
        }

        // Fun√ß√µes da tela de resultados
        function showResultsScreen() {
            if (costumes.length === 0) {
                showMessage('Nenhuma fantasia cadastrada para mostrar resultados.', 'error');
                return;
            }

            // Inicializar √°udio
            initAudioContext();

            // Ordenar fantasias por votos
            const sortedCostumes = [...costumes].sort((a, b) => b.votes - a.votes);
            
            // Criar confetti
            createConfetti();
            
            // Mostrar tela de resultados
            resultsScreen.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Criar p√≥dio
            createPodium(sortedCostumes);
            
            // Adicionar efeito sonoro visual (vibra√ß√£o se suportada)
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        function createPodium(sortedCostumes) {
            podiumContainer.innerHTML = '';
            
            // Pegar os 3 primeiros (ou menos se n√£o houver 3)
            const topThree = sortedCostumes.slice(0, 3);
            
            // Se n√£o houver pelo menos 3 fantasias, mostrar mensagem
            if (topThree.length < 3) {
                podiumContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); font-size: 1.2rem;">
                        <p>Precisa de pelo menos 3 fantasias para mostrar o p√≥dio completo.</p>
                        <p>Atualmente h√° ${topThree.length} fantasia(s) cadastrada(s).</p>
                    </div>
                `;
                return;
            }

            // Criar p√≥dios com timing dram√°tico
            const places = [
                { costume: topThree[0], place: 'first', number: '1¬∫', delay: 8 },
                { costume: topThree[1], place: 'second', number: '2¬∫', delay: 5 },
                { costume: topThree[2], place: 'third', number: '3¬∫', delay: 2 }
            ];

            // Tocar sons nos momentos certos
            setTimeout(() => playDrumRoll(), 1000); // Tambores antes do 3¬∫ lugar
            setTimeout(() => playDrumRoll(), 4000); // Tambores antes do 2¬∫ lugar
            setTimeout(() => {
                playDrumRoll();
                setTimeout(() => playVictorySound(), 1500); // Som de vit√≥ria ap√≥s o 1¬∫ lugar
            }, 7000); // Tambores antes do 1¬∫ lugar

            places.forEach(({ costume, place, number, delay }) => {
                const podiumPlace = document.createElement('div');
                podiumPlace.className = `podium-place ${place}`;
                
                const safeName = costume.name.replace(/[<>]/g, '');
                const safeDescription = costume.description ? costume.description.replace(/[<>]/g, '') : '';
                
                podiumPlace.innerHTML = `
                    <div class="podium-stand ${place}">
                        <div class="podium-number">${number}</div>
                        <img src="${costume.imageUrl}" alt="${safeName}" class="podium-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjMzMzIiByeD0iNjAiLz4KPHRleHQgeD0iNjAiIHk9IjYwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM2NjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkVycm88L3RleHQ+Cjwvc3ZnPgo='">
                        <div class="podium-name">${safeName}</div>
                        <div class="podium-votes">${costume.votes} voto${costume.votes !== 1 ? 's' : ''}</div>
                        ${safeDescription ? `<div class="podium-description">${safeDescription}</div>` : ''}
                    </div>
                `;
                
                podiumContainer.appendChild(podiumPlace);
                
                // Adicionar efeito de spotlight no momento da revela√ß√£o
                setTimeout(() => {
                    const podiumStand = podiumPlace.querySelector('.podium-stand');
                    podiumStand.classList.add('revealing');
                    setTimeout(() => {
                        podiumStand.classList.remove('revealing');
                    }, 2000);
                }, delay * 1000);
            });
        }

        function createConfetti() {
            // Limpar confetti existente
            celebration.innerHTML = '';
            
            // Criar confetti
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                celebration.appendChild(confetti);
            }
            
            // Remover confetti ap√≥s 5 segundos
            setTimeout(() => {
                celebration.innerHTML = '';
            }, 5000);
        }

        function hideResultsScreen() {
            resultsScreen.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function shareResults() {
            if (costumes.length === 0) {
                showMessage('Nenhuma fantasia para compartilhar.', 'error');
                return;
            }

            const sortedCostumes = [...costumes].sort((a, b) => b.votes - a.votes);
            const topThree = sortedCostumes.slice(0, 3);
            
            let shareText = 'üèÜ RESULTADOS DA VOTA√á√ÉO DE FANTASIAS DE HALLOWEEN üèÜ\n\n';
            
            topThree.forEach((costume, index) => {
                const position = ['ü•á', 'ü•à', 'ü•â'][index];
                shareText += `${position} ${index + 1}¬∫ LUGAR: ${costume.name} - ${costume.votes} voto${costume.votes !== 1 ? 's' : ''}\n`;
                if (costume.description) {
                    shareText += `   "${costume.description}"\n`;
                }
                shareText += '\n';
            });
            
            shareText += 'üéÉ Parab√©ns aos vencedores! üéÉ';
            
            if (navigator.share) {
                navigator.share({
                    title: 'Resultados da Vota√ß√£o de Halloween',
                    text: shareText
                }).catch(err => {
                    console.log('Erro ao compartilhar:', err);
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showMessage('Resultados copiados para a √°rea de transfer√™ncia!');
                }).catch(() => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showMessage('Resultados copiados para a √°rea de transfer√™ncia!');
            } catch (err) {
                showMessage('N√£o foi poss√≠vel copiar os resultados.', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // Fun√ß√µes de compartilhamento de dados
        function exportData() {
            try {
                const dataToExport = {
                    costumes: costumes,
                    voterVotes: voterVotes,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `halloween-voting-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showMessage('Dados exportados com sucesso! Salve o arquivo e compartilhe com os participantes.');
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                showMessage('Erro ao exportar dados.', 'error');
            }
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (!importedData.costumes || !Array.isArray(importedData.costumes)) {
                            showMessage('Arquivo inv√°lido. Certifique-se de que √© um arquivo de dados da vota√ß√£o.', 'error');
                            return;
                        }
                        
                        if (confirm('Isso substituir√° todos os dados atuais. Tem certeza?')) {
                            costumes = importedData.costumes;
                            voterVotes = importedData.voterVotes || {};
                            currentVoter = null;
                            
                            saveData();
                            renderCostumes();
                            showMessage('Dados importados com sucesso!');
                        }
                    } catch (error) {
                        console.error('Erro ao importar dados:', error);
                        showMessage('Erro ao importar dados. Arquivo corrompido ou inv√°lido.', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        async function loadSharedData() {
            const url = sharedUrlInput.value.trim();
            
            if (!url) {
                showMessage('Digite uma URL v√°lida.', 'error');
                return;
            }
            
            try {
                showMessage('Carregando dados compartilhados...');
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const sharedData = await response.json();
                
                if (!sharedData.costumes || !Array.isArray(sharedData.costumes)) {
                    showMessage('URL inv√°lida. Certifique-se de que aponta para um arquivo de dados da vota√ß√£o.', 'error');
                    return;
                }
                
                if (confirm('Isso substituir√° todos os dados atuais pelos dados compartilhados. Tem certeza?')) {
                    costumes = sharedData.costumes;
                    voterVotes = sharedData.voterVotes || {};
                    currentVoter = null;
                    
                    saveData();
                    renderCostumes();
                    showMessage('Dados compartilhados carregados com sucesso!');
                }
            } catch (error) {
                console.error('Erro ao carregar dados compartilhados:', error);
                showMessage('Erro ao carregar dados. Verifique a URL e tente novamente.', 'error');
            }
        }

        function saveSharedData() {
            try {
                const dataToSave = {
                    costumes: costumes,
                    voterVotes: voterVotes,
                    lastUpdate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(dataToSave, null, 2);
                
                // Criar um arquivo tempor√°rio para download
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = 'shared-voting-data.json';
                link.click();
                
                showMessage('Arquivo de dados compartilhados criado! Fa√ßa upload deste arquivo para um servidor web e compartilhe a URL.');
            } catch (error) {
                console.error('Erro ao salvar dados compartilhados:', error);
                showMessage('Erro ao salvar dados compartilhados.', 'error');
            }
        }

        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // Calcular novo tamanho mantendo propor√ß√£o
                    let { width, height } = img;
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    // Garantir que a imagem n√£o seja muito pequena
                    if (width < 300) {
                        const scale = 300 / width;
                        width = 300;
                        height = height * scale;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Desenhar imagem redimensionada
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Converter para blob para melhor compress√£o
                    canvas.toBlob((blob) => {
                        if (blob) {
                            // Verificar se o tamanho final √© aceit√°vel (m√°ximo 200KB)
                            if (blob.size > 200 * 1024) {
                                // Se ainda for muito grande, reduzir mais a qualidade
                                const newQuality = Math.max(0.3, quality * 0.7);
                                canvas.toBlob((newBlob) => {
                                    if (newBlob) {
                                        resolve(newBlob);
                                    } else {
                                        reject(new Error('Erro ao comprimir imagem'));
                                    }
                                }, 'image/jpeg', newQuality);
                            } else {
                            resolve(blob);
                            }
                        } else {
                            reject(new Error('Erro ao comprimir imagem'));
                        }
                    }, 'image/jpeg', quality);
                };
                
                img.onerror = function() {
                    reject(new Error('Erro ao carregar imagem'));
                };
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                };
                reader.onerror = function() {
                    reject(new Error('Erro ao ler arquivo'));
                };
                reader.readAsDataURL(file);
            });
        }

        // Event Listeners para alternar entre modos
        document.querySelectorAll('input[name="image-method"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'url') {
                    urlInputGroup.style.display = 'block';
                    fileInputGroup.style.display = 'none';
                    costumeImageUrl.required = true;
                    costumeImageUpload.required = false;
                } else {
                    urlInputGroup.style.display = 'none';
                    fileInputGroup.style.display = 'block';
                    costumeImageUrl.required = false;
                    costumeImageUpload.required = true;
                }
            });
        });

        // Event Listeners do modal
        modalClose.addEventListener('click', closeImageModal);
        
        modalImage.addEventListener('click', toggleImageZoom);
        
        imageModal.addEventListener('click', (e) => {
            if (e.target === imageModal) {
                closeImageModal();
            }
        });
        
        // Fechar modal com ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && imageModal.style.display === 'block') {
                closeImageModal();
            }
        });

        // Event Listeners
        adminAccessBtn.addEventListener('click', () => {
            if (isAdminMode) {
                adminPanel.style.display = 'none';
                adminAccessBtn.textContent = 'Acesso Admin';
                isAdminMode = false;
                return;
            }

            const password = prompt('Digite a senha de administrador:');
            if (password === 'festa') {
                adminPanel.style.display = 'block';
                adminAccessBtn.textContent = 'Fechar Admin';
                isAdminMode = true;
                showMessage('Painel de administra√ß√£o ativado!');
            } else if (password !== null) {
                showMessage('Senha incorreta!', 'error');
            }
        });

        addCostumeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('costume-name').value.trim();
            const description = document.getElementById('costume-description').value.trim();
            const selectedMethod = document.querySelector('input[name="image-method"]:checked').value;
            
            if (!name) {
                showMessage('Por favor, digite o nome da fantasia.', 'error');
                return;
            }

            // Show loading state
            const submitBtn = addCostumeForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<span class="loading"></span> Adicionando...';
            submitBtn.disabled = true;

            if (selectedMethod === 'url') {
                // Modo URL
                const imageUrl = costumeImageUrl.value.trim();
                
                if (!imageUrl) {
                    showMessage('Por favor, digite a URL da imagem.', 'error');
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                if (!validateImageUrl(imageUrl)) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                try {
                    const optimizedUrl = optimizeImageUrl(imageUrl);
                    addCostume(name, optimizedUrl, description);
                    addCostumeForm.reset();
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                } catch (error) {
                    console.error('Erro ao adicionar fantasia:', error);
                    showMessage('Erro ao adicionar fantasia. Verifique a URL.', 'error');
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            } else {
                // Modo Upload
                const imageFile = costumeImageUpload.files[0];

                if (!imageFile) {
                    showMessage('Por favor, selecione uma imagem para a fantasia.', 'error');
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                if (!validateImage(imageFile)) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Usar compress√£o de imagem para reduzir o tamanho
                compressImage(imageFile)
                    .then(async (compressedImageBlob) => {
                        try {
                            // Converter blob para data URL para compatibilidade
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                try {
                                    addCostume(name, event.target.result, description);
                                    addCostumeForm.reset();
                                } catch (error) {
                                    console.error('Erro detalhado:', error);
                                    showMessage(`Erro ao processar a imagem: ${error.message || 'Arquivo corrompido'}. Tente com outra imagem.`, 'error');
                                } finally {
                                    submitBtn.textContent = originalText;
                                    submitBtn.disabled = false;
                                }
                            };
                            reader.readAsDataURL(compressedImageBlob);
                        } catch (error) {
                            console.error('Erro na compress√£o:', error);
                            showMessage(`Erro ao processar a imagem: ${error.message || 'Arquivo corrompido'}. Tente com outra imagem.`, 'error');
                            submitBtn.textContent = originalText;
                            submitBtn.disabled = false;
                        }
                    })
                    .catch(error => {
                        console.error('Erro na compress√£o:', error);
                        showMessage(`Erro ao processar a imagem: ${error.message || 'Arquivo corrompido'}. Tente com outra imagem.`, 'error');
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    });
            }
        });

        showResultsBtn.addEventListener('click', () => {
            renderCostumes(true);
            showMessage('Resultados ordenados por votos!');
        });

        // Event listeners para tela de resultados
        showResultsBtnMain.addEventListener('click', showResultsScreen);
        backToVotingBtn.addEventListener('click', hideResultsScreen);
        shareResultsBtn.addEventListener('click', shareResults);

        // Event listeners para modal de votante
        confirmVoterBtn.addEventListener('click', confirmVoter);
        cancelVoterBtn.addEventListener('click', hideVoterModal);
        identifyVoterBtn.addEventListener('click', () => {
            if (currentVoter) {
                if (confirm('Deseja alterar sua identifica√ß√£o? Isso n√£o afetar√° seus votos j√° registrados.')) {
                    showVoterModal();
                }
            } else {
                showVoterModal();
            }
        });
        
        // Fechar modal com Enter
        voterNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                confirmVoter();
            }
        });
        
        // Fechar modal clicando fora
        voterModal.addEventListener('click', (e) => {
            if (e.target === voterModal) {
                hideVoterModal();
            }
        });

        // Event listeners para autentica√ß√£o administrativa
        document.getElementById('admin-login-btn').addEventListener('click', checkAdminPassword);
        document.getElementById('logout-admin-btn').addEventListener('click', logoutAdmin);

        // Event listeners para compartilhamento de dados
        exportDataBtn.addEventListener('click', exportData);
        importDataBtn.addEventListener('click', importData);
        loadSharedDataBtn.addEventListener('click', loadSharedData);
        saveSharedDataBtn.addEventListener('click', saveSharedData);

        clearStorageBtn.addEventListener('click', () => {
            if (confirm('Tem certeza que deseja limpar o armazenamento? Isso liberar√° espa√ßo mas manter√° as fantasias na tela.')) {
                try {
                    // Manter as fantasias na mem√≥ria mas limpar o localStorage
                    const currentCostumes = [...costumes];
                    localStorage.clear();
                    costumes = currentCostumes;
                    showMessage('Armazenamento limpo! As fantasias continuam vis√≠veis.', 'success');
                } catch (error) {
                    showMessage('Erro ao limpar armazenamento.', 'error');
                }
            }
        });

        resetVotesBtn.addEventListener('click', () => {
            if (confirm('Tem certeza que deseja resetar todos os votos e fantasias? Esta a√ß√£o √© irrevers√≠vel.')) {
                try {
                costumes = [];
                voterVotes = {};
                currentVoter = null;
                localStorage.clear();
                    showMessage('Votos e fantasias resetados com sucesso!');
                renderCostumes();
                } catch (error) {
                    showMessage('Erro ao resetar dados.', 'error');
                }
            }
        });

        // Initialize the app
        window.addEventListener('load', () => {
            try {
            loadData();
            renderCostumes();
                updateStorageInfo();
            } catch (error) {
                console.error('Erro ao inicializar aplica√ß√£o:', error);
                showMessage('Erro ao inicializar aplica√ß√£o. Recarregue a p√°gina.', 'error');
            }
        });

    </script>
</body>
</html>
